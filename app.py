import streamlit as st
from datetime import date
import yfinance as yf
import pandas as pd

# --- 1. –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---
st.set_page_config(page_title="Wheel Strategy Pro", page_icon="üí∞", layout="centered")

# --- 2. –£–ü–†–ê–í–õ–ï–ù–ò–ï –ù–ê –ï–ó–ò–ö–ê ---
if 'language' not in st.session_state:
    st.session_state.language = 'BG'

# Initialize session state values if not present
if 'fetched_price' not in st.session_state:
    st.session_state.fetched_price = None

# --- 3. –†–ï–ß–ù–ò–ö –° –ü–†–ï–í–û–î–ò ---
texts = {
    'BG': {
        'title': "Wheel Strategy Calculator",
        'subtitle': "–ü—Ä–æ—Ñ–µ—Å–∏–æ–Ω–∞–ª–µ–Ω –∞–Ω–∞–ª–∏–∑ –Ω–∞ –æ–ø—Ü–∏–∏ –∏ —Ä–∏—Å–∫",
        'choose_strat': "üìÇ –ò–∑–±–µ—Ä–µ—Ç–µ –†–∞–∑–¥–µ–ª:",
        'tab_put': "üü¢ 1. –ü—Ä–æ–¥–∞–∂–±–∞ –Ω–∞ PUT (–í—Ö–æ–¥)",
        'tab_call': "üî¥ 2. –ü—Ä–æ–¥–∞–∂–±–∞ –Ω–∞ CALL (–ò–∑—Ö–æ–¥)",
        'tab_roll': "üîÑ 3. –†–æ–ª–≤–∞–Ω–µ (–°—Ü–µ–Ω–∞—Ä–∏–∏)",
        'tab_data': "üîé 4. –ü–∞–∑–∞—Ä–Ω–∏ –î–∞–Ω–Ω–∏ (Live)",
        # Market Data Section
        'md_header': "üì° –ü–∞–∑–∞—Ä–Ω–∏ –î–∞–Ω–Ω–∏ & –í–µ—Ä–∏–≥–∞ –û–ø—Ü–∏–∏",
        'md_input_lbl': "–í—ä–≤–µ–¥–µ—Ç–µ –¢–∏–∫–µ—Ä (Yahoo Finance Symbol):",
        'md_note': "‚ÑπÔ∏è –ë–µ–ª–µ–∂–∫–∞: –î–∞–Ω–Ω–∏—Ç–µ —Å–∞ —Å ~15 –º–∏–Ω –∑–∞–∫—ä—Å–Ω–µ–Ω–∏–µ. –ò–∑–ø–æ–ª–∑–≤–∞—Ç —Å–µ —Ç–∏–∫–µ—Ä–∏ –Ω–∞ Yahoo Finance.",
        'md_note_ex': "–ü—Ä–∏–º–µ—Ä–∏: 'TSLA', 'AAPL'. –ó–∞ –∫–∞–Ω–∞–¥—Å–∫–∏ –∞–∫—Ü–∏–∏ –¥–æ–±–∞–≤–µ—Ç–µ '.TO' (–Ω–∞–ø—Ä. 'U-UN.TO').",
        'md_price': "–¢–µ–∫—É—â–∞ –¶–µ–Ω–∞:",
        'md_btn_copy': "üëâ –ò–∑–ø–æ–ª–∑–≤–∞–π —Ç–∞–∑–∏ —Ü–µ–Ω–∞ –≤ –∫–∞–ª–∫—É–ª–∞—Ç–æ—Ä–∞",
        'md_chain_head': "‚õìÔ∏è –í–µ—Ä–∏–≥–∞ –û–ø—Ü–∏–∏ (Option Chain)",
        'md_exp': "–ò–∑–±–µ—Ä–∏ –ü–∞–¥–µ–∂:",
        'md_type': "–¢–∏–ø –û–ø—Ü–∏—è:",
        'md_no_data': "–ù—è–º–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏ –¥–∞–Ω–Ω–∏ –∑–∞ –æ–ø—Ü–∏–∏ –∏–ª–∏ —Ç–∏–∫–µ—Ä—ä—Ç –µ –≥—Ä–µ—à–µ–Ω.",
        'md_error': "–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ —Ç—ä—Ä—Å–µ–Ω–µ. –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ —Å–∏–º–≤–æ–ª–∞.",
        # General
        'current_price': "–¢–µ–∫—É—â–∞ —Ü–µ–Ω–∞ –Ω–∞ –∞–∫—Ü–∏—è—Ç–∞ ($)",
        'strike': "–°—Ç—Ä–∞–π–∫ –¶–µ–Ω–∞ ($)",
        'premium': "–ü—Ä–µ–º–∏—è –Ω–∞ –∞–∫—Ü–∏—è ($)",
        'date_expiry': "–î–∞—Ç–∞ –Ω–∞ –ø–∞–¥–µ–∂",
        'contracts': "–ë—Ä–æ–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∏",
        'days_left': "–û—Å—Ç–∞–≤–∞—â–∏ –¥–Ω–∏ –¥–æ –ø–∞–¥–µ–∂–∞:",
        'days_count': "–¥–Ω–∏",
        'warning_today': "‚ö†Ô∏è –ò–∑–±–µ—Ä–µ—Ç–µ –±—ä–¥–µ—â–∞ –¥–∞—Ç–∞!",
        # PUT
        'put_header': "–ê–Ω–∞–ª–∏–∑ –Ω–∞ Cash Secured Put",
        'collateral': "–ö–∞–ø–∏—Ç–∞–ª –≤ —Ä–∏—Å–∫ (Collateral)",
        'breakeven': "–¶–µ–Ω–∞ –Ω–∞ –Ω—É–ª–∞—Ç–∞ (Break-Even)",
        'buffer': "–ë—É—Ñ–µ—Ä (Discount)",
        'return_flat': "–í—ä–∑–≤—Ä–∞—â–∞–µ–º–æ—Å—Ç (Flat)",
        'return_annual': "–ì–æ–¥–∏—à–Ω–∞ (Annualized)",
        'safety_msg': "–ö–æ–ª–∫–æ –º–æ–∂–µ –¥–∞ –ø–∞–¥–Ω–µ –∞–∫—Ü–∏—è—Ç–∞, –ø—Ä–µ–¥–∏ –¥–∞ —Å—Ç–µ –Ω–∞ –∑–∞–≥—É–±–∞.",
        'danger_msg': "‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ: –¢–µ–∫—É—â–∞—Ç–∞ —Ü–µ–Ω–∞ –≤–µ—á–µ –µ –ø–æ–¥ –≤–∞—à–∞—Ç–∞ Break-Even —Ç–æ—á–∫–∞!",
        # CALL
        'call_header': "–ê–Ω–∞–ª–∏–∑ –Ω–∞ Covered Call",
        'cost_basis': "–°—Ä–µ–¥–Ω–∞ —Ü–µ–Ω–∞ (Cost Basis) ($)",
        'cap_gains': "–ö–∞–ø–∏—Ç–∞–ª–æ–≤–∞ –ü–µ—á–∞–ª–±–∞ ($)",
        'total_profit': "–û–ë–©–ê –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–Ω–∞ –ø–µ—á–∞–ª–±–∞",
        'total_return': "–û–±—â ROI (Total Return)",
        'prem_return': "–î–æ—Ö–æ–¥ –æ—Ç –ü—Ä–µ–º–∏—è",
        # ROLLING
        'roll_header': "–°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏ –ê–Ω–∞–ª–∏–∑ –Ω–∞ –†–æ–ª–≤–∞–Ω–µ",
        'roll_strategy': "–°—Ç—Ä–∞—Ç–µ–≥–∏—è:",
        'strat_call': "Covered CALL (–†–æ–ª–≤–∞–Ω–µ –Ω–∞–≥–æ—Ä–µ)",
        'strat_put': "Cash Secured PUT (–†–æ–ª–≤–∞–Ω–µ –Ω–∞–¥–æ–ª—É)",
        # Inputs & Analysis
        'orig_data': "üìú –ò—Å—Ç–æ—Ä–∏—è –Ω–∞ –ø–æ–∑–∏—Ü–∏—è—Ç–∞",
        'orig_date': "–î–∞—Ç–∞ –Ω–∞ –æ—Ç–≤–∞—Ä—è–Ω–µ (Start Date)",
        'orig_prem': "–ü—ä—Ä–≤–æ–Ω–∞—á–∞–ª–Ω–∞ –ø—Ä–µ–º–∏—è ($)",
        'curr_exp': "–¢–µ–∫—É—â –ø–∞–¥–µ–∂ (Current Expiry)",
        'new_data': "‚ú® –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –Ω–∞ –†–æ–ª–≤–∞–Ω–µ—Ç–æ",
        'old_strike': "–¢–µ–∫—É—â –°—Ç—Ä–∞–π–∫ ($)",
        'new_strike': "–ù–æ–≤ –°—Ç—Ä–∞–π–∫ ($)",
        'roll_type': "–¢–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è:",
        'roll_cost_lbl': "–¶–µ–Ω–∞ –Ω–∞ —Ä–æ–ª–≤–∞–Ω–µ—Ç–æ (Net Price)",
        'roll_credit': "Credit (–í–∑–∏–º–∞–º)",
        'roll_debit': "Debit (–ü–ª–∞—â–∞–º)",
        'new_expiry': "–ù–æ–≤ –ü–∞–¥–µ–∂",
        'an_comparison': "üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–∞ –°—Ü–µ–Ω–∞—Ä–∏–∏—Ç–µ",
        'scen_base': "1Ô∏è‚É£ –ë–ê–ó–û–í: –ù–µ –ø—Ä–∞–≤–∏—Ç–µ –Ω–∏—â–æ
